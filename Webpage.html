<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>IoT DASHBOARD V2</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
    /* --- STYLES (Your Original Design) --- */
    * { font-family: "Poppins", sans-serif; margin: 0; padding: 0; box-sizing: border-box; }
    body { background-color: #000; color: #ccc; padding: 20px; text-align: center; }

    ::-webkit-scrollbar { width: 12px; background: #000; }
    ::-webkit-scrollbar-thumb { background: #1616e4; border-radius: 6px; }

    h1 { margin-bottom: 20px; color: #fff; }
    .section {
        background: #111; border: 1px solid #444; border-radius: 10px;
        margin: 15px auto; padding: 15px; max-width: 500px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    .section h2 { color: #fff; margin-bottom: 10px; font-size: 1.2rem; }
    .section p { font-size: 1.1rem; margin: 5px 0; }
    
    .buttonsbox { display: flex; justify-content: center; gap: 10px; margin-top: 5px; }
    button {
        background-color: #1616e4; color: white; border: 2px solid #000;
        border-radius: 8px; padding: 10px 25px; font-size: 1rem;
        font-weight: 600; cursor: pointer; transition: 0.3s;
    }
    button:hover { background-color: #0099ff; transform: scale(1.05); }
    
    input[type=range] { width: 80%; cursor: pointer; }
</style>
</head>

<body>

    <h1>IoT DASHBOARD V2</h1>

    <div class="section">
        <h2>Presence Detection</h2>
        <p id="presence">Waiting...</p>
    </div>

    <div class="section">
        <h2>Temperature & Humidity</h2>
        <p id="tempHum">Waiting...</p>
    </div>

    <div class="section">
        <h2>Fire Alarm</h2>
        <p id="fireStatus">Waiting...</p>
    </div>

    <div class="section">
        <h2>Water Level</h2>
        <p id="waterLevel">Waiting...</p>
    </div>

    <div class="section">
        <h2>Day/Night</h2>
        <p id="dayNight">Waiting...</p>
    </div>

    <div class="section">
        <h2>Right Window</h2>
        <div class="buttonsbox">
            <button onclick="sendCmd('window1','open')">Open</button>
            <button onclick="sendCmd('window1','close')">Close</button>
        </div>
    </div>

    <div class="section">
        <h2>Front Window</h2>
        <div class="buttonsbox">
            <button onclick="sendCmd('window2','open')">Open</button>
            <button onclick="sendCmd('window2','close')">Close</button>
        </div>
    </div>

    <div class="section">
        <h2>Door</h2>
        <div class="buttonsbox">
            <button onclick="sendCmd('door','open')">Open</button>
            <button onclick="sendCmd('door','close')">Close</button>
        </div>
    </div>

    <div class="section">
        <h2>Fan Control</h2>
        <div class="buttonsbox">
            <button onclick="sendCmd('fan','on')">Turn ON</button>
            <button onclick="sendCmd('fan','off')">Turn OFF</button>
        </div>
    </div>

    <div class="section">
        <h2>Lights</h2>
        <p>Light 1: <input type="range" min="0" max="255" onchange="sendLight('light1', this.value)"></p>
        <p>Light 2: <input type="range" min="0" max="255" onchange="sendLight('light2', this.value)"></p>
    </div>

    <script type="module">
        // 1. We use URL imports here (Required for GitHub Pages/HTML files)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // 2. YOUR CONFIGURATION (I pasted your keys here)
        const firebaseConfig = {
            apiKey: "AIzaSyD15s4EztjneJopyZVTnX3MYo2KapA3mRw",
            authDomain: "iot-dashboard-v2-b47a0.firebaseapp.com",
            databaseURL: "https://iot-dashboard-v2-b47a0-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "iot-dashboard-v2-b47a0",
            storageBucket: "iot-dashboard-v2-b47a0.firebasestorage.app",
            messagingSenderId: "420614856946",
            appId: "1:420614856946:web:e123b9737eb7007586706b",
            measurementId: "G-3N8PY9EMHB"
        };

        // 3. Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- SEND COMMANDS (Write to Firebase) ---
        window.sendCmd = function(target, action) {
            set(ref(db, 'controls/' + target), action);
            console.log("Sent command:", target, action);
        }

        window.sendLight = function(lightName, value) {
            set(ref(db, 'controls/' + lightName), parseInt(value));
            console.log("Sent light:", lightName, value);
        }

        // --- RECEIVE SENSOR DATA (Read from Firebase) ---
        const sensorsRef = ref(db, 'sensors');
        onValue(sensorsRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                document.getElementById('presence').innerText = data.presence || "No Data";
                document.getElementById('tempHum').innerText = 
                    "Temp: " + (data.temp || 0) + " C, Hum: " + (data.humidity || 0) + "%";
                document.getElementById('fireStatus').innerText = data.fire || "Safe";
                document.getElementById('waterLevel').innerText = "Level: " + (data.water || 0);
                document.getElementById('dayNight').innerText = data.dayNight || "Unknown";
            }
        });

    </script>

</body>
</html>